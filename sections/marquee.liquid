<script
  src="{{ 'marquee.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{% assign gap_between_elements = section.settings.gap_between_elements %}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<marquee-component
  class="section spacing-style gap-style color-{{ section.settings.color_scheme }}"
  style="
    {%- render 'spacing-style', settings: section.settings %};
    {% render 'gap-style', value: gap_between_elements, name: 'marquee-gap' %}
    --marquee-direction: {{ section.settings.movement_direction }};
  "
  data-speed-factor="25"
  data-movement-direction="{{ section.settings.movement_direction }}"
>
  <div
    class="marquee__wrapper"
    ref="wrapper"
  >
    <div
      class="marquee__content"
      ref="content"
    >
      <div
        class="marquee__repeated-items"
        ref="marqueeItems[]"
      >
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- when 'text' -%}
              {%- render 'marquee-block-text', block: block -%}

            {%- when 'text_with_icon' -%}
              {%- liquid
                assign icon_type = block.settings.icon_type
                assign icon_position = block.settings.icon_position
                assign icon_size = block.settings.icon_size
                assign icon_gap = block.settings.icon_gap
                assign icon_color = block.settings.icon_color
                assign custom_icon = block.settings.custom_icon
                assign text = block.settings.text
                assign type_preset = block.settings.type_preset
                assign font_size = block.settings.font_size
              -%}

              <div 
                class="marquee__text-with-icon marquee__text-with-icon--icon-{{ icon_position }}"
                style="
                  --icon-size: {{ icon_size }}px;
                  --icon-gap: {{ icon_gap }}px;
                  --icon-color: {{ icon_color }};
                  {%- if type_preset == 'custom' -%}
                    font-size: {{ font_size }}px;
                  {%- endif -%}
                "
                {{ block.shopify_attributes }}
              >
                {%- if icon_type != 'none' -%}
                  <span class="marquee__icon">
                    {%- if icon_type == 'image' and custom_icon -%}
                      <img 
                        src="{{ custom_icon | image_url: width: 128 }}"
                        alt=""
                        width="{{ icon_size }}"
                        height="{{ icon_size }}"
                        loading="lazy"
                      >
                    {%- else -%}
                      {%- case icon_type -%}
                        {%- when 'star' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="color: var(--icon-color);">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                          </svg>
                        {%- when 'heart' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="color: var(--icon-color);">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                          </svg>
                        {%- when 'check' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <polyline points="20 6 9 17 4 12"/>
                          </svg>
                        {%- when 'arrow_right' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <line x1="5" y1="12" x2="19" y2="12"/>
                            <polyline points="12 5 19 12 12 19"/>
                          </svg>
                        {%- when 'arrow_left' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <line x1="19" y1="12" x2="5" y2="12"/>
                            <polyline points="12 19 5 12 12 5"/>
                          </svg>
                        {%- when 'sparkle' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="color: var(--icon-color);">
                            <path d="M12 0L14.59 8.41L23 11L14.59 13.59L12 22L9.41 13.59L1 11L9.41 8.41L12 0Z"/>
                          </svg>
                        {%- when 'fire' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="color: var(--icon-color);">
                            <path d="M12 23a8 8 0 0 1-8-8c0-2.69 1.46-5.08 3.64-6.64l.36-.26V7a1 1 0 0 1 2 0v1.3a6.96 6.96 0 0 1 4 0V7a1 1 0 0 1 2 0v1.1l.36.26C18.54 9.92 20 12.31 20 15a8 8 0 0 1-8 8zm0-14a6 6 0 1 0 0 12 6 6 0 0 0 0-12z"/>
                          </svg>
                        {%- when 'lightning' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="color: var(--icon-color);">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                          </svg>
                        {%- when 'gift' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <polyline points="20 12 20 22 4 22 4 12"/>
                            <rect x="2" y="7" width="20" height="5"/>
                            <line x1="12" y1="22" x2="12" y2="7"/>
                            <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/>
                            <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
                          </svg>
                        {%- when 'truck' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <rect x="1" y="3" width="15" height="13"/>
                            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
                            <circle cx="5.5" cy="18.5" r="2.5"/>
                            <circle cx="18.5" cy="18.5" r="2.5"/>
                          </svg>
                        {%- when 'percent' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <line x1="19" y1="5" x2="5" y2="19"/>
                            <circle cx="6.5" cy="6.5" r="2.5"/>
                            <circle cx="17.5" cy="17.5" r="2.5"/>
                          </svg>
                        {%- when 'tag' -%}
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--icon-color);">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                            <line x1="7" y1="7" x2="7.01" y2="7"/>
                          </svg>
                      {%- endcase -%}
                    {%- endif -%}
                  </span>
                {%- endif -%}

                <span class="marquee__text {% if type_preset != 'custom' %}{{ type_preset }}{% endif %}">
                  {{- text -}}
                </span>
              </div>

            {%- when 'icon' -%}
              {%- render 'marquee-block-logo', block: block -%}

            {%- when 'logo' -%}
              {%- render 'marquee-block-logo', block: block -%}

            {%- when '@app' -%}
              {%- render block -%}
          {%- endcase -%}
        {%- endfor -%}
      </div>
    </div>
  </div>
</marquee-component>

{% stylesheet %}
  marquee-component {
    display: block;
    width: 100%;
    overflow: hidden;
  }

  .marquee__wrapper {
    display: flex;
    gap: var(--marquee-gap);
    width: fit-content;
    white-space: nowrap;
  }

  .marquee__content {
    min-width: max-content;
    display: flex;
    gap: var(--marquee-gap);
  }

  .marquee__content :is(p, h1, h2, h3, h4, h5, h6) {
    white-space: nowrap;
  }

  .marquee__content .marquee__repeated-items * {
    max-width: none;
  }

  .marquee__repeated-items {
    min-width: max-content;
    display: flex;
    gap: var(--marquee-gap);
    align-items: center;
    justify-content: center;
  }

  .marquee__repeated-items > * {
    align-content: center;
  }

  /* Estilos para texto con iconos */
  .marquee__text-with-icon {
    display: inline-flex;
    align-items: center;
    gap: var(--icon-gap, 8px);
  }

  .marquee__text-with-icon--icon-left {
    flex-direction: row;
  }

  .marquee__text-with-icon--icon-right {
    flex-direction: row-reverse;
  }

  .marquee__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: var(--icon-size, 24px);
    height: var(--icon-size, 24px);
  }

  .marquee__icon svg {
    width: 100%;
    height: 100%;
  }

  .marquee__icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  @media (prefers-reduced-motion: no-preference) {
    marquee-component:not([data-disabled]) .marquee__wrapper {
      animation: marquee-motion var(--marquee-speed) linear infinite var(--marquee-direction);
    }
  }

  @keyframes marquee-motion {
    to {
      transform: translate3d(calc(-50% - (var(--marquee-gap) / 2)), 0, 0);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.marquee",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Make things better"
        },
        {
          "type": "select",
          "id": "type_preset",
          "label": "Text Style",
          "options": [
            {
              "value": "h1",
              "label": "Heading 1"
            },
            {
              "value": "h2",
              "label": "Heading 2"
            },
            {
              "value": "h3",
              "label": "Heading 3"
            },
            {
              "value": "body",
              "label": "Body"
            }
          ],
          "default": "h2"
        }
      ]
    },
    {
      "type": "text_with_icon",
      "name": "Text with Icon",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Free Shipping"
        },
        {
          "type": "header",
          "content": "Icon Settings"
        },
        {
          "type": "select",
          "id": "icon_type",
          "label": "Icon Type",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "image",
              "label": "Custom Image"
            },
            {
              "value": "star",
              "label": "Star"
            },
            {
              "value": "heart",
              "label": "Heart"
            },
            {
              "value": "check",
              "label": "Check"
            },
            {
              "value": "arrow_right",
              "label": "Arrow Right"
            },
            {
              "value": "arrow_left",
              "label": "Arrow Left"
            },
            {
              "value": "sparkle",
              "label": "Sparkle"
            },
            {
              "value": "fire",
              "label": "Fire"
            },
            {
              "value": "lightning",
              "label": "Lightning"
            },
            {
              "value": "gift",
              "label": "Gift"
            },
            {
              "value": "truck",
              "label": "Truck (Shipping)"
            },
            {
              "value": "percent",
              "label": "Percent (Discount)"
            },
            {
              "value": "tag",
              "label": "Tag"
            }
          ],
          "default": "star"
        },
        {
          "type": "image_picker",
          "id": "custom_icon",
          "label": "Custom Icon Image",
          "info": "Upload your own icon (PNG or SVG recommended). Only used when Icon Type is 'Custom Image'."
        },
        {
          "type": "select",
          "id": "icon_position",
          "label": "Icon Position",
          "options": [
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ],
          "default": "left"
        },
        {
          "type": "range",
          "id": "icon_size",
          "label": "Icon Size",
          "min": 12,
          "max": 64,
          "step": 2,
          "unit": "px",
          "default": 24
        },
        {
          "type": "range",
          "id": "icon_gap",
          "label": "Space between icon and text",
          "min": 0,
          "max": 32,
          "step": 2,
          "unit": "px",
          "default": 8
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Icon Color",
          "default": "#000000",
          "info": "Only applies to SVG icons, not custom images"
        },
        {
          "type": "header",
          "content": "Text Styling"
        },
        {
          "type": "select",
          "id": "type_preset",
          "label": "Text Style",
          "options": [
            {
              "value": "h1",
              "label": "Heading 1"
            },
            {
              "value": "h2",
              "label": "Heading 2"
            },
            {
              "value": "h3",
              "label": "Heading 3"
            },
            {
              "value": "h4",
              "label": "Heading 4"
            },
            {
              "value": "body",
              "label": "Body"
            },
            {
              "value": "custom",
              "label": "Custom"
            }
          ],
          "default": "h2"
        },
        {
          "type": "range",
          "id": "font_size",
          "label": "Custom Font Size",
          "min": 12,
          "max": 72,
          "step": 1,
          "unit": "px",
          "default": 24,
          "info": "Only applies when Text Style is 'Custom'"
        }
      ]
    },
    {
      "type": "icon",
      "name": "Icon",
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            {
              "value": "star",
              "label": "Star"
            },
            {
              "value": "heart",
              "label": "Heart"
            },
            {
              "value": "sparkle",
              "label": "Sparkle"
            }
          ],
          "default": "star"
        },
        {
          "type": "range",
          "id": "icon_size",
          "label": "Size",
          "min": 12,
          "max": 64,
          "step": 2,
          "unit": "px",
          "default": 24
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Color",
          "default": "#000000"
        }
      ]
    },
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Logo Image"
        },
        {
          "type": "range",
          "id": "logo_height",
          "label": "Height",
          "min": 20,
          "max": 100,
          "step": 5,
          "unit": "px",
          "default": 40
        }
      ]
    },
    {
      "type": "divider",
      "name": "Divider",
      "settings": [
        {
          "type": "text",
          "id": "divider_text",
          "label": "Divider Text",
          "default": "â€¢"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "select",
      "id": "movement_direction",
      "label": "t:settings.motion_direction",
      "options": [
        {
          "value": "reverse",
          "label": "t:options.forward"
        },
        {
          "value": "normal",
          "label": "t:options.reverse"
        }
      ],
      "default": "normal"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "gap_between_elements",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "Marquee",
      "category": "Text",
      "blocks": [
        {
          "type": "text_with_icon",
          "settings": {
            "text": "Free Shipping",
            "icon_type": "truck",
            "icon_position": "left",
            "icon_size": 24
          }
        },
        {
          "type": "text_with_icon",
          "settings": {
            "text": "Best Sellers",
            "icon_type": "star",
            "icon_position": "left",
            "icon_size": 24
          }
        },
        {
          "type": "text_with_icon",
          "settings": {
            "text": "New Arrivals",
            "icon_type": "sparkle",
            "icon_position": "left",
            "icon_size": 24
          }
        }
      ]
    }
  ]
}
{% endschema %}
