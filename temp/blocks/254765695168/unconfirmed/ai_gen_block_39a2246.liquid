{% doc %}
  @prompt
    Crea una sección para Shopify basada en bloques dinámicos (blocks) que utilice un efecto de superposición de tarjetas (Overlapping Cards). La arquitectura debe permitir que cada tarjeta esté configurada con una posición sticky en el tope de la pantalla. Al hacer scroll hacia abajo, la tarjeta siguiente debe subir y posicionarse directamente sobre la anterior, cubriéndola por completo, de modo que siempre la tarjeta más reciente sea la que quede "de frente" al usuario.
    
    Cada bloque (tarjeta) debe ocupar el 100% de la altura de la pantalla (100vh) para maximizar el efecto visual y debe ser editable de forma independiente con las siguientes funciones:
    
    Edición de Contenido: Campos para Título y Texto Descriptivo.
    
    Personalización de Estilo: Selectores para color de fondo, color de texto (título y cuerpo), color de borde (1px) y selección de tipografía.
    
    Alineación de Texto: Un control para elegir entre izquierda, derecha, centrado o justificado de forma individual por cada bloque.
    
    Diseño: Esquinas con un redondeo sutil de 15px y controles de padding interno para asegurar la legibilidad.
    
    La sección debe incluir una animación de entrada para los elementos internos de cada tarjeta y ser totalmente responsiva, adaptando el tamaño de las fuentes en móviles. Incluye controles globales para los márgenes superiores e inferiores de la sección completa.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-overlapping-cards-section-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    margin-top: {{ block.settings.section_margin_top }}px;
    margin-bottom: {{ block.settings.section_margin_bottom }}px;
  }

  .ai-overlapping-card-{{ ai_gen_id }} {
    position: sticky;
    top: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: {{ block.settings.card_padding }}px;
    background-color: {{ block.settings.background_color }};
    border: 1px solid {{ block.settings.border_color }};
    border-radius: 15px;
    overflow: hidden;
  }

  .ai-overlapping-card-content-{{ ai_gen_id }} {
    max-width: 800px;
    width: 100%;
    text-align: {{ block.settings.text_alignment }};
    opacity: 0;
    transform: translateY(30px);
    animation: ai-card-fade-in-{{ ai_gen_id }} 0.8s ease-out forwards;
    animation-delay: 0.2s;
  }

  @keyframes ai-card-fade-in-{{ ai_gen_id }} {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .ai-overlapping-card-title-{{ ai_gen_id }} {
    font-family: {{ block.settings.title_font.family }}, {{ block.settings.title_font.fallback_families }};
    font-weight: {{ block.settings.title_font.weight }};
    font-style: {{ block.settings.title_font.style }};
    color: {{ block.settings.title_color }};
    font-size: 48px;
    line-height: 1.2;
    margin: 0 0 24px 0;
  }

  .ai-overlapping-card-text-{{ ai_gen_id }} {
    font-family: {{ block.settings.text_font.family }}, {{ block.settings.text_font.fallback_families }};
    font-weight: {{ block.settings.text_font.weight }};
    font-style: {{ block.settings.text_font.style }};
    color: {{ block.settings.text_color }};
    font-size: 18px;
    line-height: 1.6;
    margin: 0;
  }

  @media screen and (max-width: 749px) {
    .ai-overlapping-card-{{ ai_gen_id }} {
      padding: {{ block.settings.card_padding | times: 0.6 }}px;
    }

    .ai-overlapping-card-title-{{ ai_gen_id }} {
      font-size: 32px;
    }

    .ai-overlapping-card-text-{{ ai_gen_id }} {
      font-size: 16px;
    }
  }
{% endstyle %}

<overlapping-cards-{{ ai_gen_id }} class="ai-overlapping-cards-section-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-overlapping-card-{{ ai_gen_id }}">
    <div class="ai-overlapping-card-content-{{ ai_gen_id }}">
      {% if block.settings.title != blank %}
        <h2 class="ai-overlapping-card-title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
      {% endif %}
      {% if block.settings.text != blank %}
        <div class="ai-overlapping-card-text-{{ ai_gen_id }}">{{ block.settings.text }}</div>
      {% endif %}
    </div>
  </div>
</overlapping-cards-{{ ai_gen_id }}>

<script>
  (function() {
    class OverlappingCards{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.observeCards();
      }

      observeCards() {
        const cards = this.querySelectorAll('.ai-overlapping-card-{{ ai_gen_id }}');
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.style.zIndex = Math.floor(entry.intersectionRatio * 100);
            }
          });
        }, {
          threshold: Array.from({ length: 101 }, (_, i) => i / 100)
        });

        cards.forEach(card => observer.observe(card));
      }
    }

    customElements.define('overlapping-cards-{{ ai_gen_id }}', OverlappingCards{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Tarjeta superpuesta",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Contenido"
    },
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Título",
      "default": "Título de la tarjeta"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Texto descriptivo",
      "default": "<p>Escribe aquí el contenido descriptivo de tu tarjeta. Este texto se mostrará debajo del título.</p>"
    },
    {
      "type": "header",
      "content": "Alineación"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Alineación del texto",
      "options": [
        {
          "value": "left",
          "label": "Izquierda"
        },
        {
          "value": "center",
          "label": "Centro"
        },
        {
          "value": "right",
          "label": "Derecha"
        },
        {
          "value": "justify",
          "label": "Justificado"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Colores"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Fondo",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Color del título",
      "default": "#3e2563"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto",
      "default": "#3e2563"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Color del borde",
      "default": "#3e2563"
    },
    {
      "type": "header",
      "content": "Tipografía"
    },
    {
      "type": "font_picker",
      "id": "title_font",
      "label": "Fuente del título",
      "default": "montserrat_n7"
    },
    {
      "type": "font_picker",
      "id": "text_font",
      "label": "Fuente del texto",
      "default": "montserrat_n4"
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Padding interno",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "section_margin_top",
      "label": "Margen superior",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "section_margin_bottom",
      "label": "Margen inferior",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Tarjeta superpuesta"
    }
  ]
}
{% endschema %}
