{%- doc -%}
  Renders a header menu block con controles avanzados de tipografía y efectos.
  @param {string} [variant] - Versión del menú (mobile, navigation_bar o default).
{%- enddoc -%}

{% liquid
  assign block_settings = block.settings
  assign animation_speed = 200
  assign unique_id = 'HeaderMenu-' | append: block.id | replace: '_', ''
%}

<div id="{{ unique_id }}" class="custom-header-menu-wrapper" {{ block.shopify_attributes }}>
  <style>
    /* VARIABLES DINÁMICAS BASADAS EN CONFIGURACIÓN */
    #{{ unique_id }} {
      --menu-font-size: {{ block.settings.menu_font_size }}px;
      --menu-font-weight: {{ block.settings.menu_font_weight }};
      --menu-text-color: {{ block.settings.text_color | default: 'currentColor' }};
      --menu-hover-color: {{ block.settings.hover_text_color }};
      --hover-duration: {{ block.settings.hover_transition_duration }}ms;
      --item-spacing: {{ block.settings.item_spacing }}px;
      background: transparent !important;
    }

    /* ESTILO DE LOS ENLACES (DESKTOP) */
    #{{ unique_id }} .menu-list__link {
      font-size: var(--menu-font-size) !important;
      font-weight: var(--menu-font-weight) !important;
      color: var(--menu-text-color) !important;
      text-transform: {{ block.settings.type_case_primary_link }};
      padding: {{ block.settings.link_padding_vertical }}px {{ block.settings.link_padding_horizontal }}px;
      transition: all var(--hover-duration) ease;
      position: relative;
      display: flex;
      align-items: center;
      text-decoration: none;
    }

    /* ESPACIADO ENTRE ELEMENTOS */
    #{{ unique_id }} .menu-list__list {
      gap: var(--item-spacing);
      justify-content: {{ block.settings.alignment }};
    }

    /* EFECTOS ON HOVER */
    #{{ unique_id }} .menu-list__list-item {
      transition: transform var(--hover-duration) cubic-bezier(0.4, 0, 0.2, 1);
    }

    #{{ unique_id }} .menu-list__list-item:hover .menu-list__link {
      color: var(--menu-hover-color) !important;
    }

    {% if block.settings.enable_hover_effect %}
      #{{ unique_id }} .menu-list__list-item:hover {
        {% if block.settings.hover_effect_type == 'scale' %}
          transform: scale({{ block.settings.hover_scale }});
        {% elsif block.settings.hover_effect_type == 'slide_up' %}
          transform: translateY(-5px);
        {% endif %}
        z-index: 10;
      }
    {% endif %}

    /* EFECTO SUBRAYADO ANIMADO */
    {% if block.settings.hover_underline %}
      #{{ unique_id }} .menu-list__link::after {
        content: '';
        position: absolute;
        bottom: {{ block.settings.underline_offset }}px;
        left: 50%;
        width: 0;
        height: {{ block.settings.underline_thickness }}px;
        background-color: var(--menu-hover-color);
        transition: all var(--hover-duration) ease;
        transform: translateX(-50%);
      }
      #{{ unique_id }} .menu-list__list-item:hover .menu-list__link::after {
        width: 80%;
      }
    {% endif %}

    /* RESPONSIVE: AJUSTES PARA MÓVIL */
    @media screen and (max-width: 749px) {
      #{{ unique_id }} {
        --menu-font-size: {{ block.settings.mobile_font_size }}px;
      }
      #{{ unique_id }} .menu-list--mobile .menu-list__list {
        flex-direction: {{ block.settings.mobile_layout }};
        align-items: center;
        gap: 15px;
      }
    }
  </style>

  {% case variant %}
    {% when 'mobile' %}
      <div class="header__drawer desktop:hidden" ref="headerDrawerContainer">
        {% render 'header-drawer', 
           class: 'header__drawer--mobile', 
           linklist: block_settings.menu, 
           data_header_drawer_type: 'mobile-drawer' 
        %}
      </div>

    {% when 'navigation_bar' %}
      {% if block_settings.navigation_bar == true %}
        <div class="menu-list menu-list--mobile">
          <div class="menu-list__scroll-container">
            <ul class="menu-list__list list-unstyled" role="list">
              {% for link in block_settings.menu.links %}
                <li class="menu-list__list-item">
                  <a href="{{ link.url }}" class="menu-list__link {% if link.current %}active{% endif %}">
                    {{- link.title -}}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}

    {% else %}
      <header-menu class="header-menu mobile:hidden" data-animation-delay="{{ animation_speed }}">
        <div class="header-menu__inner">
          {%- render 'header-menu' %}
        </div>
      </header-menu>
  {% endcase %}
</div>

{% stylesheet %}
  .menu-list { display: flex; width: 100%; }
  .menu-list__list { display: flex; list-style: none; margin: 0; padding: 0; width: 100%; }
  .menu-list__scroll-container { width: 100%; overflow-x: auto; padding: 10px 0; }
  .mobile\:hidden { display: block; }
  .desktop\:hidden { display: none; }
  
  @media screen and (max-width: 989px) {
    .mobile\:hidden { display: none !important; }
    .desktop\:hidden { display: block !important; }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Menú Pro Premium",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Seleccionar Menú",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Tipografía y Colores"
    },
    {
      "type": "range",
      "id": "menu_font_size",
      "label": "Tamaño de fuente (Desktop)",
      "min": 12, "max": 40, "step": 1, "unit": "px", "default": 16
    },
    {
      "type": "select",
      "id": "menu_font_weight",
      "label": "Peso de fuente",
      "options": [
        { "value": "300", "label": "Ligera" },
        { "value": "400", "label": "Normal" },
        { "value": "600", "label": "Semi-Bold" },
        { "value": "700", "label": "Negrita" }
      ],
      "default": "400"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color de texto",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "hover_text_color",
      "label": "Color Hover",
      "default": "#ff0000"
    },
    {
      "type": "header",
      "content": "Diseño y Espaciado"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alineación Horizontal",
      "options": [
        { "value": "flex-start", "label": "Izquierda" },
        { "value": "center", "label": "Centro" },
        { "value": "flex-end", "label": "Derecha" },
        { "value": "space-between", "label": "Distribuido" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "item_spacing",
      "label": "Espacio entre pestañas",
      "min": 0, "max": 100, "step": 5, "unit": "px", "default": 20
    },
    {
      "type": "range",
      "id": "link_padding_vertical",
      "label": "Padding Vertical del Link",
      "min": 0, "max": 30, "step": 1, "unit": "px", "default": 10
    },
    {
      "type": "range",
      "id": "link_padding_horizontal",
      "label": "Padding Horizontal del Link",
      "min": 0, "max": 40, "step": 1, "unit": "px", "default": 15
    },
    {
      "type": "header",
      "content": "Animaciones"
    },
    {
      "type": "checkbox",
      "id": "enable_hover_effect",
      "label": "Activar Efecto de Movimiento",
      "default": true
    },
    {
      "type": "select",
      "id": "hover_effect_type",
      "label": "Tipo de Movimiento",
      "options": [
        { "value": "scale", "label": "Escalar (Agrandar)" },
        { "value": "slide_up", "label": "Deslizar hacia arriba" }
      ],
      "default": "scale"
    },
    {
      "type": "range",
      "id": "hover_scale",
      "label": "Nivel de escala",
      "min": 1.0, "max": 1.3, "step": 0.1, "default": 1.1
    },
    {
      "type": "checkbox",
      "id": "hover_underline",
      "label": "Activar Subrayado Animado",
      "default": true
    },
    {
      "type": "range",
      "id": "underline_thickness",
      "label": "Grosor subrayado",
      "min": 1, "max": 5, "step": 1, "unit": "px", "default": 2
    },
    {
      "type": "range",
      "id": "underline_offset",
      "label": "Distancia subrayado",
      "min": 0, "max": 15, "step": 1, "unit": "px", "default": 5
    },
    {
      "type": "range",
      "id": "hover_transition_duration",
      "label": "Duración de animación (ms)",
      "min": 100, "max": 800, "step": 50, "default": 300
    },
    {
      "type": "header",
      "content": "Configuración Móvil"
    },
    {
      "type": "checkbox",
      "id": "navigation_bar",
      "label": "Mostrar barra de navegación móvil",
      "default": true
    },
    {
      "type": "select",
      "id": "mobile_layout",
      "label": "Diseño móvil",
      "options": [
        { "value": "row", "label": "Horizontal (Scroll)" },
        { "value": "column", "label": "Vertical (Lista)" }
      ],
      "default": "row"
    },
    {
      "type": "range",
      "id": "mobile_font_size",
      "label": "Tamaño fuente móvil",
      "min": 10, "max": 25, "step": 1, "unit": "px", "default": 14
    }
  ]
}
{% endschema %}