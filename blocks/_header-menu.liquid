{%- doc -%}
  Renders a header menu block con controles avanzados de tipografía y efectos.

  @param {string} [variant] - Versión del menú (mobile, navigation_bar o default).
{%- enddoc -%}

{% liquid
  assign block_settings = block.settings
  assign animation_speed = 200
  assign unique_id = 'HeaderMenu-' | append: block.id | replace: '_', ''
%}

<div id="{{ unique_id }}" class="custom-menu-logic-wrapper">
  <style>
    /* VARIABLES CSS INTEGRADAS EN EL TEMA ORIGINAL */
    :root {
      --menu-font-size-custom: {{ block.settings.menu_font_size }}px;
      --menu-weight-custom: {{ block.settings.menu_font_weight }};
      --menu-text-color-custom: {{ block.settings.text_color }};
      --menu-hover-color-custom: {{ block.settings.hover_text_color }};
      --menu-item-spacing-custom: {{ block.settings.item_spacing }}px;
    }

    /* APLICACIÓN DE ESTILOS PERSONALIZADOS */
    #{{ unique_id }} .menu-list__link {
      font-size: var(--menu-font-size-custom) !important;
      font-weight: var(--menu-weight-custom) !important;
      color: var(--menu-text-color-custom) !important;
      text-transform: {{ block.settings.type_case_primary_link }};
      padding: {{ block.settings.link_padding_vertical }}px {{ block.settings.link_padding_horizontal }}px !important;
      transition: all {{ block.settings.hover_transition_duration }}ms ease !important;
    }

    #{{ unique_id }} .menu-list__list {
      gap: var(--menu-item-spacing-custom) !important;
      justify-content: {{ block.settings.alignment }} !important;
    }

    /* EFECTOS HOVER */
    #{{ unique_id }} .menu-list__list-item:hover .menu-list__link {
      color: var(--menu-hover-color-custom) !important;
    }

    {% if block.settings.enable_hover_effect %}
      #{{ unique_id }} .menu-list__list-item {
        transition: transform {{ block.settings.hover_transition_duration }}ms ease !important;
      }
      #{{ unique_id }} .menu-list__list-item:hover {
        {% if block.settings.hover_effect_type == 'scale' %}
          transform: scale({{ block.settings.hover_scale }});
        {% elsif block.settings.hover_effect_type == 'slide_up' %}
          transform: translateY(-5px);
        {% endif %}
      }
    {% endif %}

    {% if block.settings.hover_underline %}
      #{{ unique_id }} .menu-list__link::after {
        content: '';
        position: absolute;
        bottom: {{ block.settings.underline_offset }}px;
        left: 50%;
        width: 0;
        height: {{ block.settings.underline_thickness }}px;
        background-color: var(--menu-hover-color-custom);
        transition: all {{ block.settings.hover_transition_duration }}ms ease;
        transform: translateX(-50%);
      }
      #{{ unique_id }} .menu-list__list-item:hover .menu-list__link::after {
        width: 80%;
      }
    {% endif %}

    /* FIX: ELIMINAR SCROLL INNECESARIO */
    #{{ unique_id }} .menu-list__scroll-container {
      overflow: visible !important;
      mask-image: none !important;
    }

    /* AJUSTES MÓVIL */
    @media screen and (max-width: 749px) {
      #{{ unique_id }} .menu-list__link {
        font-size: {{ block.settings.mobile_font_size }}px !important;
      }
    }
  </style>

  {% case variant %}
    {% when 'mobile' %}
      {% comment %} Se renderiza solo el drawer para evitar duplicados {% endcomment %}
      <div class="header__drawer desktop:hidden" ref="headerDrawerContainer" {{ block.shopify_attributes }}>
        {% render 'header-drawer',
          class: 'header__drawer--mobile',
          linklist: block_settings.menu,
          data_header_drawer_type: 'mobile-drawer'
        %}
      </div>

    {% when 'navigation_bar' %}
      {% if block_settings.navigation_bar == true %}
        <div class="menu-list menu-list--mobile">
          <div class="menu-list__scroll-container">
            <ul class="menu-list__list list-unstyled" role="list">
              {% for link in block_settings.menu.links %}
                <li class="menu-list__list-item">
                  <a href="{{ link.url }}" class="menu-list__link {% if link.current %}active{% endif %}">
                    {{- link.title -}}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}

    {% else %}
      {% comment %} Menú Desktop con JS original para Sticky y Submenús {% endcomment %}
      <header-menu
        ref="headerMenu"
        class="header-menu mobile:hidden"
        data-animation-delay="{{ animation_speed }}"
        {{ block.shopify_attributes }}
      >
        <div class="header-menu__inner">
          {%- render 'header-menu' %}
        </div>
        <script src="{{ 'header-menu.js' | asset_url }}" type="module" fetchpriority="low"></script>
      </header-menu>
  {% endcase %}
</div>

{% schema %}
{
  "name": "Menú Pro (Sticky Fixed)",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Seleccionar Menú",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Tipografía y Colores"
    },
    {
      "type": "range",
      "id": "menu_font_size",
      "label": "Tamaño de fuente (Desktop)",
      "min": 12,
      "max": 40,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "select",
      "id": "menu_font_weight",
      "label": "Peso de fuente",
      "options": [
        { "value": "300", "label": "Ligera" },
        { "value": "400", "label": "Normal" },
        { "value": "600", "label": "Semi-Bold" },
        { "value": "700", "label": "Negrita" }
      ],
      "default": "400"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color de texto",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "hover_text_color",
      "label": "Color Hover",
      "default": "#ff0000"
    },
    {
      "type": "select",
      "id": "type_case_primary_link",
      "label": "Transformación de texto",
      "options": [
        { "value": "none", "label": "Normal" },
        { "value": "uppercase", "label": "MAYÚSCULAS" }
      ],
      "default": "none"
    },
    {
      "type": "header",
      "content": "Diseño y Espaciado"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alineación Desktop",
      "options": [
        { "value": "flex-start", "label": "Izquierda" },
        { "value": "center", "label": "Centro" },
        { "value": "flex-end", "label": "Derecha" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "item_spacing",
      "label": "Espacio entre elementos",
      "min": 0,
      "max": 80,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "link_padding_vertical",
      "label": "Padding Vertical Link",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "link_padding_horizontal",
      "label": "Padding Horizontal Link",
      "min": 0,
      "max": 40,
      "step": 1,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "Animaciones"
    },
    {
      "type": "checkbox",
      "id": "enable_hover_effect",
      "label": "Activar Efecto Movimiento",
      "default": true
    },
    {
      "type": "select",
      "id": "hover_effect_type",
      "label": "Tipo de Efecto",
      "options": [
        { "value": "scale", "label": "Escalar" },
        { "value": "slide_up", "label": "Deslizar Arriba" }
      ],
      "default": "scale"
    },
    {
      "type": "range",
      "id": "hover_scale",
      "label": "Nivel de escala",
      "min": 1.0,
      "max": 1.3,
      "step": 0.1,
      "default": 1.1
    },
    {
      "type": "checkbox",
      "id": "hover_underline",
      "label": "Subrayado Animado",
      "default": true
    },
    {
      "type": "range",
      "id": "underline_thickness",
      "label": "Grosor subrayado",
      "min": 1,
      "max": 5,
      "step": 1,
      "unit": "px",
      "default": 2
    },
    {
      "type": "range",
      "id": "underline_offset",
      "label": "Distancia subrayado",
      "min": 0,
      "max": 15,
      "step": 1,
      "unit": "px",
      "default": 5
    },
    {
      "type": "range",
      "id": "hover_transition_duration",
      "label": "Velocidad (ms)",
      "min": 100,
      "max": 1000,
      "step": 50,
      "default": 300
    },
    {
      "type": "header",
      "content": "Configuración Móvil"
    },
    {
      "type": "checkbox",
      "id": "navigation_bar",
      "label": "Habilitar Navigation Bar",
      "default": false
    },
    {
      "type": "range",
      "id": "mobile_font_size",
      "label": "Fuente Móvil",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    }
  ]
}
{% endschema %}
