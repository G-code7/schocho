{%- doc -%}
  Renders a header menu block.
  @param {string} [variant] - What version of the menu to render.
  @param {string} [transparent] - Show a transparent menu
{%- enddoc -%}

{% liquid
  assign block_settings = block.settings
  assign animation_speed = 200
  assign unique_id = 'HeaderMenu-' | append: block.id
%}

{% if block.settings.enable_hover_effect %}
  <style>
    #{{ unique_id }} .menu-list__list-item {
      transition: transform 300ms ease;
    }
    #{{ unique_id }} .menu-list__list-item:hover {
      transform: scale({{ block.settings.hover_scale }});
    }
  </style>
{% endif %}

<div id="{{ unique_id }}" class="custom-header-menu-wrapper">
  <style>
    /* Variables CSS personalizadas */
    #{{ unique_id }} {
      --menu-top-level-font-size: {{ block.settings.menu_font_size }}px;
      --menu-top-level-font-weight: {{ block.settings.menu_font_weight }};
    }

    /* Aplicación de tipografía */
    #{{ unique_id }} .menu-list__link {
      font-size: var(--menu-top-level-font-size) !important;
      font-weight: var(--menu-top-level-font-weight) !important;
      text-transform: {{ block.settings.type_case_primary_link }};
    }

    /* Asegurar que el contenedor interno sea transparente */
    #{{ unique_id }} .header-menu__inner {
      background: transparent !important;
    }

    /* Margin top para mobile */
    @media screen and (max-width: 749px) {
      #{{ unique_id }} .header__drawer,
      #{{ unique_id }} .menu-list--mobile {
        margin-top: 1.5rem;
      }
    }
  </style>

  {% case variant %}
    {% when 'mobile' %}
      <div
        class="header__drawer desktop:hidden"
        ref="headerDrawerContainer"
        {{ block.shopify_attributes }}
      >
        {% render 'header-drawer',
          class: 'header__drawer--mobile',
          linklist: block_settings.menu,
          data_header_drawer_type: 'mobile-drawer'
        %}
      </div>

    {% when 'navigation_bar' %}
      {% if block_settings.navigation_bar == true %}
        <div
          class="menu-list menu-list--mobile"
          style="--menu-horizontal-gap: 15px; --mobile-nav-margin: auto;"
        >
          <div class="menu-list__scroll-container">
            <ul
              class="menu-list__list list-unstyled"
              role="list"
            >
              {% for link in block_settings.menu.links %}
                <li>
                  <a
                    href="{{ link.url }}"
                    id="MenuItem-{{ link.handle }}"
                    class="menu-list__item menu-list__link"
                    {% if link.current %}
                      aria-current="page"
                    {% endif %}
                  >
                    {{- link.title -}}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}
    {% else %}
      <header-menu
        ref="headerMenu"
        class="header-menu mobile:hidden"
        data-animation-delay="{{ animation_speed }}"
        {{ block.shopify_attributes }}
        style="--submenu-animation-speed: {{ animation_speed }}ms;"
      >
        <div class="header-menu__inner">
          {%- render 'header-menu' %}
        </div>

        <script
          src="{{ 'header-menu.js' | asset_url }}"
          type="module"
          fetchpriority="low"
        ></script>
      </header-menu>
  {% endcase %}
</div>

{% stylesheet %}
  /* Estilos base para mobile menu */
  .menu-list--mobile.menu-list {
    display: grid;
  }
  
  .menu-list--mobile .menu-list__list {
    width: max-content;
    margin-inline: auto;
    gap: var(--menu-horizontal-gap);
  }
  
  .menu-list--mobile li {
    width: max-content;
    padding-block: var(--padding-sm);
  }
  
  .menu-list--mobile li:first-of-type {
    padding-inline-start: var(--menu-horizontal-gap);
  }
  
  .menu-list--mobile li:last-of-type {
    padding-inline-end: var(--menu-horizontal-gap);
  }
  
  .menu-list--mobile a {
    color: var(--color-foreground);
  }

  .menu-list__scroll-container {
    position: relative;
    overflow-x: auto;
    mask-image: linear-gradient(to right, transparent, #000 20px, #000 calc(100% - 20px), transparent);
    padding-block: var(--padding-2xs);
  }

  header-menu {
    width: 100%;
  }

  /* Drawer menu featured content */
  .menu-drawer__featured-content {
    z-index: var(--layer-base);
    container-type: inline-size;
  }

  .menu-drawer__featured-content--childlist {
    z-index: var(--layer-flat);
  }

  .menu-drawer__featured-content-list {
    display: flex;
    gap: 1em;
    overflow-x: auto;
    padding-block-end: var(--padding-lg);
  }

  .menu-drawer__featured-content-list-item {
    flex: 0 0 auto;
  }

  .menu-drawer__featured-content-list-item--product {
    width: 35cqi;
  }

  .menu-drawer__featured-content-list-item--collection img.resource-card__image {
    width: 80cqi;
  }

  .menu-drawer__featured-content-list-item:first-child {
    margin-inline-start: var(--margin-xl);
  }

  .menu-drawer__featured-content-list-item:last-child {
    margin-inline-end: var(--margin-xl);
  }

  .menu-list {
    --menu-horizontal-gap: var(--gap-xl);
    --menu-vertical-gap: var(--gap-xl);

    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
  }

  .menu-list__list {
    display: flex;
    justify-content: var(--grid-area-alignment);
    flex-wrap: wrap;
    gap: var(--menu-horizontal-gap);
  }

  .menu-list__list-item {
    flex-shrink: 0;
    white-space: nowrap;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: var(--minimum-touch-target);
  }

  .menu-list__list-item[aria-hidden='true'] {
    visibility: hidden;
  }

  .menu-list__link {
    font-family: var(--menu-top-level-font-family);
    font-style: var(--menu-top-level-font-style);
    font-weight: var(--menu-top-level-font-weight);
    font-size: var(--menu-top-level-font-size);
    line-height: var(--menu-top-level-font-line-height);
    text-transform: var(--menu-top-level-font-case);
    color: var(--menu-top-level-font-color);
    text-decoration: none;
    display: flex;
    min-height: var(--minimum-touch-target);
    align-items: center;
    justify-content: center;
    padding: 0.5rem 1rem;
    position: relative;
  }

  .menu-list__link:hover,
  .menu-list__link:focus {
    color: var(--menu-top-level-font-color);
  }

  @media screen and (min-width: 750px) {
    .menu-list__link {
      font-size: var(--menu-top-level-font-size-desktop);
    }
  }

  .menu-list:where(:has(.menu-list__list-item:hover)) .menu-list__link,
  .menu-list:where(:has(.menu-list__list-item:focus-within)) .menu-list__link,
  .menu-list:where(:has(.menu-list__list-item:not([aria-hidden='true']) .menu-list__link--active)) .menu-list__link {
    color: rgb(var(--menu-top-level-font-color-rgb) / var(--opacity-subdued-text));
  }

  .menu-list:not(:has(.menu-list__list-item:hover)) .menu-list__link--active,
  .menu-list .menu-list__list-item:where(:hover, :focus-within) .menu-list__link,
  .menu-list .menu-list__list-item[slot='overflow'] .menu-list__link[aria-expanded='true'] {
    color: var(--menu-top-level-font-color);
  }

  /* Responsive adjustments */
  @media screen and (max-width: 749px) {
    .menu-list {
      --menu-horizontal-gap: var(--gap-md);
      flex-direction: column;
      align-items: stretch;
    }

    .menu-list__list {
      flex-direction: column;
      width: 100%;
      gap: var(--gap-sm);
    }

    .menu-list__list-item {
      width: 100%;
      justify-content: flex-start;
      padding: 0.5rem 1rem;
    }

    .menu-list__link {
      width: 100%;
      justify-content: flex-start;
      padding: 0.75rem 1rem;
    }

    /* Slightly more subtle hover effect on mobile */
    .menu-list__list-item:hover,
    .menu-list__list-item:focus-within,
    .menu-list__list-item.menu-list__link--active {
      transform: scale(1.02);
    }
  }

  @media screen and (min-width: 750px) and (max-width: 989px) {
    .menu-list {
      --menu-horizontal-gap: var(--gap-lg);
    }

    .menu-list__list {
      flex-wrap: wrap;
      justify-content: center;
    }
  }

  @media screen and (min-width: 990px) {
    .menu-list {
      --menu-horizontal-gap: var(--gap-xl);
    }

    .menu-list__list {
      flex-wrap: nowrap;
      justify-content: var(--grid-area-alignment);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.menu",
  "tag": null,
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:settings.menu",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Ajustes de Tipografía"
    },
    {
      "type": "range",
      "id": "menu_font_size",
      "label": "Tamaño de fuente",
      "min": 10,
      "max": 50,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "menu_font_weight",
      "label": "Peso de fuente",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "400"
    },
    {
      "type": "select",
      "id": "type_case_primary_link",
      "label": "t:settings.text_case",
      "options": [
        { "value": "none", "label": "t:options.default" },
        { "value": "uppercase", "label": "t:options.uppercase" }
      ],
      "default": "none"
    },
    {
      "type": "header",
      "content": "Efectos"
    },
    {
      "type": "checkbox",
      "id": "enable_hover_effect",
      "label": "Activar escala en Hover",
      "default": false
    },
    {
      "type": "range",
      "id": "hover_scale",
      "label": "Nivel de escala",
      "min": 1.0,
      "max": 2.0,
      "step": 0.1,
      "default": 1.1
    },
    {
      "type": "header",
      "content": "t:content.mobile_layout"
    },
    {
      "type": "checkbox",
      "id": "navigation_bar",
      "label": "t:settings.navigation_bar",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "drawer_accordion",
      "label": "t:settings.accordion",
      "default": false
    }
  ]
}
{% endschema %}