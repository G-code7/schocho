{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-claims-container-{{ ai_gen_id }} {
    display: block;
    width: 100%;
  }

  .ai-claims-list-{{ ai_gen_id }} {
    display: flex;
    flex-wrap: wrap;
    gap: {{ block.settings.gap }}px;
    align-items: center;
  }

  .ai-claim-item-{{ ai_gen_id }} {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: {{ block.settings.padding_vertical }}px {{ block.settings.padding_horizontal }}px;
    background-color: {{ block.settings.background_color }};
    color: {{ block.settings.text_color }};
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    border-radius: {{ block.settings.border_radius }}px;
    font-size: {{ block.settings.font_size }}px;
    line-height: 1.2;
    white-space: nowrap;
  }

  .ai-claims-empty-{{ ai_gen_id }} {
    color: #999;
    font-size: 14px;
    font-style: italic;
    padding: 10px 0;
  }

  @media screen and (max-width: 749px) {
    .ai-claims-list-{{ ai_gen_id }} {
      gap: {{ block.settings.gap_mobile }}px;
    }

    .ai-claim-item-{{ ai_gen_id }} {
      font-size: {{ block.settings.font_size_mobile }}px;
      padding: {{ block.settings.padding_vertical_mobile }}px {{ block.settings.padding_horizontal_mobile }}px;
    }
  }
{% endstyle %}

<div class="ai-claims-container-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {%- liquid
    # Obtener el metafield
    assign claims_metafield = product.metafields.custom.claims
    assign has_claims = false
    assign claims_array = null
    
    if claims_metafield != blank
      # Intentar obtener .value (para metafields tipo list o JSON)
      assign claims_value = claims_metafield.value
      
      # Si .value existe y es un array (tiene .first)
      if claims_value != blank and claims_value.first != blank
        assign claims_array = claims_value
        assign has_claims = true
      
      # Si .value existe pero no es array, es string
      elsif claims_value != blank
        assign claims_string = claims_value | strip
        
        # Limpiar posibles caracteres JSON residuales
        assign claims_string = claims_string | remove: '[' | remove: ']' | remove: '"'
        assign claims_array = claims_string | split: ','
        assign has_claims = true
      
      # Si no hay .value, usar el metafield directamente (texto plano)
      else
        assign claims_string = claims_metafield | strip
        
        # Verificar si parece ser JSON (empieza con [)
        if claims_string contains '['
          assign claims_string = claims_string | remove: '[' | remove: ']' | remove: '"'
        endif
        
        assign claims_array = claims_string | split: ','
        assign has_claims = true
      endif
    endif
    
    # Verificar que realmente hay claims
    if claims_array == blank or claims_array.size == 0
      assign has_claims = false
    endif
  -%}

  {% if has_claims %}
    <div class="ai-claims-list-{{ ai_gen_id }}">
      {% for claim in claims_array %}
        {%- assign trimmed_claim = claim | strip -%}
        {% if trimmed_claim != blank %}
          <span class="ai-claim-item-{{ ai_gen_id }}">{{ trimmed_claim }}</span>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <div class="ai-claims-empty-{{ ai_gen_id }}">
      Agrega claims al metafield custom.claims (separados por coma o como lista)
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "Product claims",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Estilo"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Fondo",
      "default": "#f5f4ed"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Texto",
      "default": "#3e2563"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Borde",
      "default": "#ac9e89"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Grosor del borde",
      "default": 1
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Redondez",
      "default": 50
    },
    {
      "type": "header",
      "content": "Tamaño desktop"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Tamaño de texto",
      "default": 12
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "min": 8,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Padding horizontal",
      "default": 12
    },
    {
      "type": "range",
      "id": "padding_vertical",
      "min": 2,
      "max": 12,
      "step": 1,
      "unit": "px",
      "label": "Padding vertical",
      "default": 4
    },
    {
      "type": "range",
      "id": "gap",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Espacio entre claims",
      "default": 8
    },
    {
      "type": "header",
      "content": "Tamaño móvil"
    },
    {
      "type": "range",
      "id": "font_size_mobile",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Tamaño de texto",
      "default": 10
    },
    {
      "type": "range",
      "id": "padding_horizontal_mobile",
      "min": 6,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Padding horizontal",
      "default": 10
    },
    {
      "type": "range",
      "id": "padding_vertical_mobile",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Padding vertical",
      "default": 3
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "min": 2,
      "max": 16,
      "step": 2,
      "unit": "px",
      "label": "Espacio entre claims",
      "default": 6
    }
  ],
  "presets": [
    {
      "name": "Product claims"
    }
  ]
}
{% endschema %}
